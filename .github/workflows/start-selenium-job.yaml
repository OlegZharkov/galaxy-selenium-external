name: Selenium Runner

# Run this workflow every time a new commit pushed to your repository
on: push

jobs:
  prepare-selenium-tests:
    name: Selenium Run
    runs-on: ubuntu-20.04
    strategy:
          matrix:
            python-version: [3.8]
    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: Cache multiple paths
        uses: actions/cache@v2
        with:
          path: |
            galaxy/.venv/
          key: ${{ runner.os }}-selenium

      - name: run
        run: |
          TEST_VAR=$(source run.sh ${{ secrets.KEY }})
          echo "::set-output name=selenium_tests::{\"include\":$TEST_VAR}"


  run-selenium-tests:
    name: Individual Test
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        python-version: [3.8]
        selenium-tests: ${{fromJson(needs.prepare-selenium-tests.outputs.selenium_tests)}}
    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: run
        env:
          selenium-test: ${{ matrix.selenium_tests }}
        run: |
          echo "$selenium-test"
